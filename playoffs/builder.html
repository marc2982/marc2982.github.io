<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>NHL Playoffs Pool - Builder</title>
	<style>
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
			max-width: 800px;
			margin: 50px auto;
			padding: 20px;
			background: #f5f5f5;
		}
		.container {
			background: white;
			padding: 30px;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
		h1 {
			color: #333;
			margin-top: 0;
		}
		.section {
			margin: 30px 0;
			padding: 20px;
			background: #f9f9f9;
			border-radius: 4px;
		}
		button {
			background: #0066cc;
			color: white;
			border: none;
			padding: 12px 24px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 16px;
			margin: 5px;
		}
		button:hover {
			background: #0052a3;
		}
		button:disabled {
			background: #ccc;
			cursor: not-allowed;
		}
		select {
			padding: 8px;
			font-size: 16px;
			border-radius: 4px;
			border: 1px solid #ddd;
		}
		#status {
			margin-top: 20px;
			padding: 15px;
			border-radius: 4px;
			display: none;
		}
		#status.success {
			background: #d4edda;
			color: #155724;
			border: 1px solid #c3e6cb;
		}
		#status.error {
			background: #f8d7da;
			color: #721c24;
			border: 1px solid #f5c6cb;
		}
		#status.info {
			background: #d1ecf1;
			color: #0c5460;
			border: 1px solid #bee5eb;
		}
		.progress {
			margin-top: 10px;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>üèí NHL Playoffs Pool - Builder</h1>
		<p>Generate yearly summary JSON files from CSV data</p>

		<div class="section">
			<h2>Build Single Year</h2>
			<select id="yearSelect">
				<option value="">Loading years...</option>
			</select>
			<button id="buildYearBtn" onclick="buildYear()">Build Year</button>
		</div>

		<div class="section">
			<h2>Build All Years</h2>
			<button id="buildAllBtn" onclick="buildAllYears()">Build All Years</button>
		</div>

		<div class="section">
			<h2>Generate Index</h2>
			<button id="buildIndexBtn" onclick="buildIndex()">Generate yearly_index.json</button>
		</div>

		<div id="status"></div>
	</div>

	<script type="module">
		import { loadAvailableYears, buildYearSummary, buildYearlyIndex } from './js/builder.js';

		// Make functions globally available
		window.buildYear = buildYear;
		window.buildAllYears = buildAllYears;
		window.buildIndex = buildIndex;

		// Load available years immediately
		(async () => {
			const years = await loadAvailableYears();
			const select = document.getElementById('yearSelect');
			if (years.length > 0) {
				select.innerHTML = years.map(year => `<option value="${year}">${year}</option>`).join('');
			} else {
				select.innerHTML = '<option value="">No years found</option>';
			}
		})();

		async function buildYear() {
			const year = document.getElementById('yearSelect').value;
			if (!year) {
				showStatus('Please select a year', 'error');
				return;
			}

			showStatus(`Building ${year}...`, 'info');
			setButtonsEnabled(false);

			try {
				await buildYearSummary(year);
				showStatus(`‚úÖ ${year}.json built successfully! Check your downloads folder.`, 'success');
			} catch (error) {
				showStatus(`‚ùå Error building ${year}: ${error.message}`, 'error');
				console.error(error);
			} finally {
				setButtonsEnabled(true);
			}
		}

		async function buildAllYears() {
			showStatus('Building all years...', 'info');
			setButtonsEnabled(false);

			const years = await loadAvailableYears();
			let successCount = 0;
			let failCount = 0;

			for (const year of years) {
				try {
					showStatus(`Building ${year}... (${successCount + failCount + 1}/${years.length})`, 'info');
					await buildYearSummary(year);
					successCount++;
				} catch (error) {
					console.error(`Failed to build ${year}:`, error);
					failCount++;
				}
			}

			showStatus(`‚úÖ Built ${successCount} years successfully. ${failCount} failed. Check your downloads folder.`, 'success');
			setButtonsEnabled(true);
		}

		async function buildIndex() {
			showStatus('Generating yearly index...', 'info');
			setButtonsEnabled(false);

			try {
				await buildYearlyIndex();
				showStatus('‚úÖ yearly_index.json generated successfully! Check your downloads folder.', 'success');
			} catch (error) {
				showStatus(`‚ùå Error generating index: ${error.message}`, 'error');
				console.error(error);
			} finally {
				setButtonsEnabled(true);
			}
		}

		function showStatus(message, type) {
			const status = document.getElementById('status');
			status.textContent = message;
			status.className = type;
			status.style.display = 'block';
		}

		function setButtonsEnabled(enabled) {
			document.getElementById('buildYearBtn').disabled = !enabled;
			document.getElementById('buildAllBtn').disabled = !enabled;
			document.getElementById('buildIndexBtn').disabled = !enabled;
		}
	</script>
</body>
</html>
